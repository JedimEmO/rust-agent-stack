# File Service WASM Example

This example demonstrates how to use the `file_service!` macro with TypeScript through WebAssembly.

## Structure

- `file-service-api/` - The API library crate that contains the service definition
- `typescript-example/` - TypeScript/HTML example showing client usage

## How it Works

1. The `file_service!` macro generates both server and client code
2. The client code is compiled to WASM using wasm-pack with the `wasmpack-client` feature
3. TypeScript bindings are automatically generated by wasm-bindgen
4. The browser can use these bindings to interact with the file service

## Building the WASM Package

```bash
cd file-service-api
./build-wasm.sh
# or
npm run build
```

This generates TypeScript bindings in `file-service-api/pkg/`.

## Running the Example

1. First, build the WASM package as shown above

2. Start a local web server in the typescript-example directory:
   ```bash
   cd typescript-example
   python3 -m http.server 8000
   ```

3. Open http://localhost:8000 in your browser

4. Make sure your file service server is running on http://localhost:3000

## Key Differences for WASM

When targeting WASM, the upload methods have different signatures:

**Native (non-WASM):**
```rust
pub async fn upload(
    &self,
    file_path: impl AsRef<std::path::Path>,
    file_name: Option<&str>,
    content_type: Option<&str>
) -> Result<UploadResponse, Box<dyn std::error::Error>>
```

**WASM:**
```rust
pub async fn upload(
    &self,
    file_bytes: Vec<u8>,
    file_name: &str,
    content_type: Option<&str>
) -> Result<UploadResponse, Box<dyn std::error::Error>>
```

The WASM wrapper handles the conversion from browser File API to bytes automatically.

## TypeScript Usage

```typescript
import init, { WasmDocumentServiceClient } from './pkg/file_service_api.js';

// Initialize WASM
await init();

// Create client
const client = new WasmDocumentServiceClient('http://localhost:3000');

// Set authentication token (optional)
client.set_bearer_token('your-token-here');

// Upload a file
const file = document.getElementById('fileInput').files[0];
const uploadResponse = await client.upload(file);

// Download a file
const fileData = await client.download('file-id');
```

## Server Implementation

The server can use the same API crate:

```rust
// In your server Cargo.toml
[dependencies]
file-service-api = { path = "../file-service-api", features = ["server"] }

// In your server code
use file_service_api::{DocumentServiceServer, UploadResponse};

struct MyDocumentService;

#[async_trait]
impl DocumentServiceServer for MyDocumentService {
    async fn upload(
        &self,
        auth: Option<AuthenticatedUser>,
        multipart: Multipart,
    ) -> Result<UploadResponse, FileServiceError> {
        // Implementation
    }
    
    // ... other methods
}
```