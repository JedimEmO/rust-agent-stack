<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Documentation - Google OAuth2 Example</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>📚</text></svg>">
    <style>
        :root {
            --primary-color: #4285f4;
            --primary-hover: #3367d6;
            --secondary-color: #34a853;
            --secondary-hover: #2e9447;
            --danger-color: #ea4335;
            --warning-color: #fbbc04;
            --surface-color: #ffffff;
            --background-color: #f8f9fa;
            --text-primary: #202124;
            --text-secondary: #5f6368;
            --text-muted: #9aa0a6;
            --border-color: #dadce0;
            --shadow-light: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            --shadow-medium: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
            --border-radius: 8px;
            --border-radius-large: 12px;
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-primary);
        }

        .background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="%23ffffff" opacity="0.05"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }

        @media (max-width: 968px) {
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            .sidebar {
                position: static !important;
                height: auto !important;
            }
        }

        .sidebar {
            background: var(--surface-color);
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-medium);
            padding: 30px;
            position: sticky;
            top: 20px;
            height: fit-content;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }

        .sidebar h2 {
            margin: 0 0 20px 0;
            color: var(--text-primary);
            font-size: 1.3em;
        }

        .sidebar nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar nav li {
            margin-bottom: 8px;
        }

        .sidebar nav a {
            color: var(--text-secondary);
            text-decoration: none;
            padding: 8px 12px;
            border-radius: var(--border-radius);
            display: block;
            transition: var(--transition-normal);
            font-size: 14px;
        }

        .sidebar nav a:hover {
            background: var(--background-color);
            color: var(--primary-color);
        }

        .sidebar nav a.active {
            background: var(--primary-color);
            color: white;
        }

        .main-content {
            min-width: 0;
        }

        .header {
            background: var(--surface-color);
            padding: 40px;
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-medium);
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }

        .header h1 {
            color: var(--text-primary);
            margin: 0 0 16px 0;
            font-size: 2.2em;
            font-weight: 600;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: var(--text-secondary);
            margin: 0 0 20px 0;
            font-size: 1.1em;
        }

        .header-actions {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .button {
            background: var(--primary-color);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition-normal);
        }

        .button:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }

        .button.secondary {
            background: var(--surface-color);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .button.secondary:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .endpoint {
            background: var(--surface-color);
            padding: 40px;
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-medium);
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
            position: relative;
        }

        .endpoint:target {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
        }

        .endpoint h3 {
            color: var(--text-primary);
            margin: 0 0 20px 0;
            font-size: 1.4em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .method-name {
            background: var(--primary-color);
            color: white;
            padding: 6px 12px;
            border-radius: var(--border-radius);
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
            font-size: 13px;
            font-weight: 600;
        }

        .permissions {
            background: #e8f5e8;
            border-left: 4px solid var(--secondary-color);
            padding: 16px 20px;
            margin: 20px 0;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
        }

        .permissions.admin {
            background: #ffebee;
            border-left-color: var(--danger-color);
        }

        .permissions.elevated {
            background: #fff8e1;
            border-left-color: var(--warning-color);
        }

        .permissions strong {
            color: var(--text-primary);
        }

        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 24px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
            font-size: 13px;
            overflow-x: auto;
            position: relative;
            border: 1px solid #333;
        }

        .code-block.json {
            background: #f8f9fa;
            color: #333;
            border: 1px solid var(--border-color);
        }

        .code-block::before {
            content: attr(data-language);
            position: absolute;
            top: 8px;
            right: 12px;
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .copy-button {
            position: absolute;
            top: 12px;
            right: 60px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #d4d4d4;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: var(--transition-normal);
        }

        .copy-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .param-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-light);
        }

        .param-table th,
        .param-table td {
            border: 1px solid var(--border-color);
            padding: 16px;
            text-align: left;
        }

        .param-table th {
            background: var(--background-color);
            font-weight: 600;
            color: var(--text-primary);
        }

        .param-table td {
            background: var(--surface-color);
        }

        .param-table code {
            background: #f1f3f4;
            padding: 3px 6px;
            border-radius: 3px;
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            color: var(--danger-color);
        }

        .auth-section {
            background: #fff8e1;
            border: 1px solid #ffb74d;
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 24px 0;
        }

        .auth-section strong {
            color: #ef6c00;
        }

        .try-it-section {
            background: #f8f9fa;
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            padding: 24px;
            margin: 24px 0;
            text-align: center;
        }

        .try-it-section.authenticated {
            background: #e8f5e8;
            border-color: var(--secondary-color);
        }

        .endpoint-form {
            display: none;
            background: #f8f9fa;
            padding: 24px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            border: 1px solid var(--border-color);
        }

        .endpoint-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 14px;
        }

        .form-group textarea {
            height: 120px;
            resize: vertical;
        }

        .response-section {
            margin-top: 20px;
            padding: 20px;
            background: var(--surface-color);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            display: none;
        }

        .response-section.show {
            display: block;
        }

        .status-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-right: 8px;
        }

        .status-indicator.success {
            background: #e8f5e8;
            color: #2e7d2e;
        }

        .status-indicator.error {
            background: #ffebee;
            color: #c62828;
        }

        .animate-fade-in {
            animation: fadeIn 0.6s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .floating-toc {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100;
            display: none;
        }

        @media (min-width: 1200px) {
            .floating-toc {
                display: block;
            }
        }

        .toc-toggle {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            box-shadow: var(--shadow-medium);
            font-size: 20px;
            transition: var(--transition-normal);
        }

        .toc-toggle:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="background-overlay"></div>
    <div class="container">
        <div class="sidebar">
            <h2>📚 Navigation</h2>
            <nav>
                <ul>
                    <li><a href="/examples/google-oauth-example/server/static" class="button secondary">← Back to Home</a></li>
                    <li><a href="#authentication">🔐 Authentication</a></li>
                    <li><a href="#endpoints">📋 Endpoints</a></li>
                    <li><a href="#get_user_info">👤 Get User Info</a></li>
                    <li><a href="#list_documents">📄 List Documents</a></li>
                    <li><a href="#create_document">➕ Create Document</a></li>
                    <li><a href="#delete_document">🗑️ Delete Document</a></li>
                    <li><a href="#get_system_status">⚙️ System Status</a></li>
                    <li><a href="#get_beta_features">🧪 Beta Features</a></li>
                    <li><a href="#permissions">🎯 Permissions</a></li>
                    <li><a href="#examples">💡 Examples</a></li>
                </ul>
            </nav>
            
            <div style="margin-top: 30px; padding: 16px; background: var(--background-color); border-radius: var(--border-radius); font-size: 13px;">
                <strong>💡 Pro Tip:</strong><br>
                Use the "Try It" buttons to test endpoints directly from this page!
            </div>
        </div>
        
        <div class="main-content">
            <div class="header animate-fade-in">
                <h1>📚 JSON-RPC API Documentation</h1>
                <p>Interactive documentation for the Google OAuth2 Example - Rust Agent Stack</p>
                <div class="header-actions">
                    <button id="authStatusBtn" class="button secondary" onclick="checkAuthStatus()">🔄 Check Auth Status</button>
                    <button class="button" onclick="window.open('/', '_blank')">🚀 Try OAuth2 Flow</button>
                </div>
            </div>

            <div class="endpoint" id="authentication">
                <h3>🔐 Authentication</h3>
                <p>All API endpoints require authentication using a JWT token obtained through the OAuth2 flow. Include the token in the Authorization header:</p>
                <div class="code-block" data-language="http">
                    <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
Authorization: Bearer YOUR_JWT_TOKEN
                </div>
                
                <div class="auth-section" id="authSection">
                    <strong>Note:</strong> To get a JWT token, complete the OAuth2 flow by clicking "Sign in with Google" on the home page. 
                    The token will be displayed on the success page.
                </div>
                
                <div class="try-it-section" id="tokenSection">
                    <h4>🔑 JWT Token Manager</h4>
                    <p>Enter your JWT token to enable interactive API testing:</p>
                    <div style="display: flex; gap: 12px; margin-top: 16px; align-items: center;">
                        <input type="password" id="jwtToken" placeholder="Paste your JWT token here..." 
                               style="flex: 1; padding: 12px; border: 1px solid var(--border-color); border-radius: var(--border-radius);">
                        <button class="button" onclick="setJwtToken()">Set Token</button>
                        <button class="button secondary" onclick="clearToken()">Clear</button>
                    </div>
                    <p id="tokenStatus" style="margin-top: 12px; font-size: 14px; color: var(--text-secondary);">No token set</p>
                </div>
            </div>

            <div class="endpoint" id="endpoints">
                <h3>📌 Available Endpoints</h3>
                <p>All requests use the JSON-RPC 2.0 protocol. Send POST requests to <code>/api/rpc</code> with the following structure:</p>
                <div class="code-block json" data-language="json">
                    <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
{
  "jsonrpc": "2.0",
  "method": "METHOD_NAME",
  "params": { /* parameters */ },
  "id": 1
}
                </div>
                
                <div style="background: var(--background-color); padding: 20px; border-radius: var(--border-radius); margin: 20px 0;">
                    <h4>🎯 Quick Stats</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-top: 12px;">
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: 600; color: var(--primary-color);">6</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Total Endpoints</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: 600; color: var(--secondary-color);">3</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Permission Levels</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: 600; color: var(--warning-color);">100%</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Type Safe</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Get User Info -->
            <div class="endpoint animate-fade-in" id="get_user_info">
                <h3>
                    <span class="method-name">get_user_info</span>
                    Get Current User Information
                </h3>
                <div class="permissions">
                    <strong>Required Permissions:</strong> Authenticated user (no specific permissions required)
                </div>
                <p>Returns information about the currently authenticated user, including their permissions and metadata.</p>
                
                <div class="try-it-section" data-endpoint="get_user_info">
                    <button class="button" onclick="toggleEndpointForm('get_user_info')">🧪 Try It Out</button>
                </div>
                
                <div class="endpoint-form" id="form_get_user_info">
                    <h4>Interactive Testing</h4>
                    <div class="form-group">
                        <label>Request ID:</label>
                        <input type="number" value="1" id="id_get_user_info">
                    </div>
                    <button class="button" onclick="testEndpoint('get_user_info', {})">Send Request</button>
                    <div class="response-section" id="response_get_user_info"></div>
                </div>
                
                <h4>Request Parameters</h4>
                <table class="param-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Type</th>
                            <th>Required</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="4"><em>No parameters required</em></td>
                        </tr>
                    </tbody>
                </table>

                <h4>Example Request</h4>
                <div class="code-block json" data-language="json">
                    <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
{
  "jsonrpc": "2.0",
  "method": "get_user_info",
  "params": {},
  "id": 1
}
                </div>

                <h4>Example Response</h4>
                <div class="code-block json" data-language="json">
                    <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
{
  "jsonrpc": "2.0",
  "result": {
    "user_id": "104872499792737890123",
    "permissions": ["user:read", "profile:read", "admin:read", "admin:write"],
    "metadata": {
      "picture": "https://lh3.googleusercontent.com/...",
      "email_verified": true
    }
  },
  "id": 1
}
                </div>
            </div>

            <!-- List Documents -->
            <div class="endpoint animate-fade-in" id="list_documents">
                <h3>
                    <span class="method-name">list_documents</span>
                    List Documents
                </h3>
                <div class="permissions">
                    <strong>Required Permissions:</strong> <code>user:read</code>
                </div>
                <p>Retrieves a paginated list of documents available to the user.</p>
                
                <div class="try-it-section" data-endpoint="list_documents">
                    <button class="button" onclick="toggleEndpointForm('list_documents')">🧪 Try It Out</button>
                </div>
                
                <div class="endpoint-form" id="form_list_documents">
                    <h4>Interactive Testing</h4>
                    <div class="form-group">
                        <label>Limit (max 100):</label>
                        <input type="number" value="5" min="1" max="100" id="limit_list_documents">
                    </div>
                    <div class="form-group">
                        <label>Offset:</label>
                        <input type="number" value="0" min="0" id="offset_list_documents">
                    </div>
                    <div class="form-group">
                        <label>Request ID:</label>
                        <input type="number" value="2" id="id_list_documents">
                    </div>
                    <button class="button" onclick="testListDocuments()">Send Request</button>
                    <div class="response-section" id="response_list_documents"></div>
                </div>
                
                <h4>Request Parameters</h4>
                <table class="param-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Type</th>
                            <th>Required</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>limit</code></td>
                            <td>integer</td>
                            <td>No</td>
                            <td>Maximum number of documents to return (default: 10, max: 100)</td>
                        </tr>
                        <tr>
                            <td><code>offset</code></td>
                            <td>integer</td>
                            <td>No</td>
                            <td>Number of documents to skip (default: 0)</td>
                        </tr>
                    </tbody>
                </table>

                <h4>Example Request</h4>
                <div class="code-block json" data-language="json">
                    <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
{
  "jsonrpc": "2.0",
  "method": "list_documents",
  "params": {
    "limit": 5,
    "offset": 0
  },
  "id": 2
}
                </div>

                <h4>Example Response</h4>
                <div class="code-block json" data-language="json">
                    <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
{
  "jsonrpc": "2.0",
  "result": {
    "documents": [
      {
        "id": "doc_1",
        "title": "Getting Started with OAuth2",
        "created_at": "2024-01-15T10:30:00Z",
        "tags": ["oauth2", "authentication"]
      }
    ],
    "total": 3
  },
  "id": 2
}
                </div>
            </div>

            <!-- Create Document -->
            <div class="endpoint animate-fade-in" id="create_document">
                <h3>
                    <span class="method-name">create_document</span>
                    Create Document
                </h3>
                <div class="permissions elevated">
                    <strong>Required Permissions:</strong> <code>content:create</code>
                </div>
                <p>Creates a new document. Requires elevated permissions.</p>
                
                <div class="try-it-section" data-endpoint="create_document">
                    <button class="button" onclick="toggleEndpointForm('create_document')">🧪 Try It Out</button>
                </div>
                
                <div class="endpoint-form" id="form_create_document">
                    <h4>Interactive Testing</h4>
                    <div class="form-group">
                        <label>Title:</label>
                        <input type="text" value="My Test Document" id="title_create_document">
                    </div>
                    <div class="form-group">
                        <label>Content:</label>
                        <textarea id="content_create_document" placeholder="Enter document content...">This is a test document created via the API playground.</textarea>
                    </div>
                    <div class="form-group">
                        <label>Tags (comma-separated):</label>
                        <input type="text" value="api, test, playground" id="tags_create_document">
                    </div>
                    <div class="form-group">
                        <label>Request ID:</label>
                        <input type="number" value="3" id="id_create_document">
                    </div>
                    <button class="button" onclick="testCreateDocument()">Send Request</button>
                    <div class="response-section" id="response_create_document"></div>
                </div>
                
                <h4>Request Parameters</h4>
                <table class="param-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Type</th>
                            <th>Required</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>title</code></td>
                            <td>string</td>
                            <td>Yes</td>
                            <td>Title of the document</td>
                        </tr>
                        <tr>
                            <td><code>content</code></td>
                            <td>string</td>
                            <td>Yes</td>
                            <td>Content of the document</td>
                        </tr>
                        <tr>
                            <td><code>tags</code></td>
                            <td>array[string]</td>
                            <td>Yes</td>
                            <td>Tags for categorizing the document</td>
                        </tr>
                    </tbody>
                </table>

                <h4>Example Request</h4>
                <div class="code-block json" data-language="json">
                    <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
{
  "jsonrpc": "2.0",
  "method": "create_document",
  "params": {
    "title": "My New Document",
    "content": "This is the document content...",
    "tags": ["example", "tutorial"]
  },
  "id": 3
}
                </div>
            </div>

            <!-- Delete Document -->
        <div class="endpoint">
            <h3>
                <span class="method-name">delete_document</span>
                Delete Document
            </h3>
            <div class="permissions admin">
                <strong>Required Permissions:</strong> <code>admin:write</code>
            </div>
            <p>Deletes a document. Requires admin permissions.</p>
            
            <h4>Request Parameters</h4>
            <table class="param-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Type</th>
                        <th>Required</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>document_id</code></td>
                        <td>string</td>
                        <td>Yes</td>
                        <td>ID of the document to delete</td>
                    </tr>
                </tbody>
            </table>

            <h4>Example Request</h4>
            <div class="code-block json">
{
  "jsonrpc": "2.0",
  "method": "delete_document",
  "params": {
    "document_id": "doc_123"
  },
  "id": 4
}
            </div>
        </div>

        <!-- System Status -->
        <div class="endpoint">
            <h3>
                <span class="method-name">get_system_status</span>
                Get System Status
            </h3>
            <div class="permissions admin">
                <strong>Required Permissions:</strong> <code>system:admin</code>
            </div>
            <p>Retrieves system status information. Requires system admin permissions.</p>
            
            <h4>Example Response</h4>
            <div class="code-block json">
{
  "jsonrpc": "2.0",
  "result": {
    "status": {
      "uptime_seconds": 12345,
      "memory_usage_mb": 256,
      "active_sessions": 42,
      "version": "1.0.0-example"
    }
  },
  "id": 5
}
            </div>
        </div>

        <!-- Beta Features -->
        <div class="endpoint">
            <h3>
                <span class="method-name">get_beta_features</span>
                Get Beta Features
            </h3>
            <div class="permissions elevated">
                <strong>Required Permissions:</strong> <code>beta:access</code>
            </div>
            <p>Lists available beta features for the user.</p>
            
            <h4>Example Response</h4>
            <div class="code-block json">
{
  "jsonrpc": "2.0",
  "result": {
    "features": [
      {
        "name": "Advanced Analytics",
        "description": "Enhanced analytics dashboard with real-time metrics",
        "enabled": true
      }
    ]
  },
  "id": 6
}
            </div>
        </div>

        <div class="endpoint" id="permissions">
            <h3>🎯 Permission System</h3>
            <p>The application uses a role-based permission system based on user attributes:</p>
            
            <h4>Permission Assignment Rules</h4>
            <table class="param-table">
                <thead>
                    <tr>
                        <th>User Type</th>
                        <th>Criteria</th>
                        <th>Permissions Granted</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Basic User</td>
                        <td>Any authenticated user</td>
                        <td><code>user:read</code>, <code>profile:read</code></td>
                    </tr>
                    <tr>
                        <td>Verified User</td>
                        <td>Email verified by OAuth provider</td>
                        <td>+ <code>email:verified</code></td>
                    </tr>
                    <tr>
                        <td>Trusted Domain</td>
                        <td>Email ends with <code>@trusted-domain.com</code></td>
                        <td>+ <code>user:write</code>, <code>content:create</code>, <code>content:edit</code></td>
                    </tr>
                    <tr>
                        <td>Admin User</td>
                        <td>Email ends with <code>@example.com</code></td>
                        <td>+ <code>admin:read</code>, <code>admin:write</code>, <code>system:manage</code></td>
                    </tr>
                    <tr>
                        <td>System Admin</td>
                        <td>Special subject ID</td>
                        <td>+ <code>system:admin</code>, <code>debug:access</code></td>
                    </tr>
                    <tr>
                        <td>Beta User</td>
                        <td>Subject starts with <code>beta_</code></td>
                        <td>+ <code>beta:access</code>, <code>feature:preview</code></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="endpoint" id="examples">
            <h3>🧪 Complete Examples</h3>
            
            <h4>Testing with curl</h4>
            <p>Here are complete curl examples for testing the API:</p>
            
            <div class="code-block">
# Replace YOUR_JWT_TOKEN with your actual token from the OAuth2 flow

# Get user info
curl -X POST http://localhost:3000/api/rpc \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "jsonrpc": "2.0",
    "method": "get_user_info",
    "params": {},
    "id": 1
  }'

# List documents
curl -X POST http://localhost:3000/api/rpc \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "jsonrpc": "2.0",
    "method": "list_documents",
    "params": {"limit": 10},
    "id": 2
  }'

# Create document (requires content:create permission)
curl -X POST http://localhost:3000/api/rpc \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "jsonrpc": "2.0",
    "method": "create_document",
    "params": {
      "title": "API Test Document",
      "content": "Created via API",
      "tags": ["api", "test"]
    },
    "id": 3
  }'
            </div>

            <h4>Error Responses</h4>
            <p>The API returns standard JSON-RPC 2.0 error responses:</p>
            
            <div class="code-block json">
{
  "jsonrpc": "2.0",
  "error": {
    "code": -32001,
    "message": "Insufficient permissions",
    "data": {
      "required": ["admin:write"],
      "provided": ["user:read", "profile:read"]
    }
  },
  "id": 1
}
            </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let authToken = localStorage.getItem('jwt_token') || '';
        let isAuthenticated = false;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            checkStoredToken();
            initializeScrollNavigation();
        });

        function initializeScrollNavigation() {
            // Update active navigation item based on scroll position
            const navLinks = document.querySelectorAll('.sidebar nav a[href^="#"]');
            const sections = document.querySelectorAll('.endpoint[id]');
            
            function updateActiveNav() {
                let currentSection = '';
                sections.forEach(section => {
                    const rect = section.getBoundingClientRect();
                    if (rect.top <= 100) {
                        currentSection = section.id;
                    }
                });
                
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${currentSection}`) {
                        link.classList.add('active');
                    }
                });
            }
            
            window.addEventListener('scroll', updateActiveNav);
            updateActiveNav(); // Initial call
        }

        function checkStoredToken() {
            if (authToken) {
                document.getElementById('jwtToken').value = authToken.substring(0, 20) + '...';
                updateTokenStatus('Token loaded from storage', 'success');
                isAuthenticated = true;
                updateTryItSections();
            }
        }

        function checkAuthStatus() {
            const btn = document.getElementById('authStatusBtn');
            const originalText = btn.textContent;
            btn.textContent = '🔄 Checking...';
            btn.disabled = true;
            
            if (authToken) {
                // Try to decode JWT to check if it's valid
                try {
                    const payload = JSON.parse(atob(authToken.split('.')[1]));
                    const exp = payload.exp * 1000;
                    const now = Date.now();
                    
                    if (now < exp) {
                        updateTokenStatus(`Token valid until ${new Date(exp).toLocaleString()}`, 'success');
                    } else {
                        updateTokenStatus('Token has expired', 'error');
                        clearToken();
                    }
                } catch (e) {
                    updateTokenStatus('Invalid token format', 'error');
                    clearToken();
                }
            } else {
                updateTokenStatus('No token found', 'error');
            }
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.disabled = false;
            }, 1000);
        }

        function setJwtToken() {
            const tokenInput = document.getElementById('jwtToken');
            const token = tokenInput.value.trim();
            
            if (!token) {
                updateTokenStatus('Please enter a token', 'error');
                return;
            }
            
            // Basic JWT format validation
            if (!token.includes('.') || token.split('.').length !== 3) {
                updateTokenStatus('Invalid JWT format', 'error');
                return;
            }
            
            authToken = token;
            localStorage.setItem('jwt_token', token);
            isAuthenticated = true;
            updateTokenStatus('Token set successfully!', 'success');
            updateTryItSections();
            
            // Show truncated token
            tokenInput.value = token.substring(0, 20) + '...';
        }

        function clearToken() {
            authToken = '';
            localStorage.removeItem('jwt_token');
            isAuthenticated = false;
            document.getElementById('jwtToken').value = '';
            updateTokenStatus('Token cleared', 'info');
            updateTryItSections();
        }

        function updateTokenStatus(message, type) {
            const statusEl = document.getElementById('tokenStatus');
            statusEl.textContent = message;
            statusEl.style.color = type === 'success' ? 'var(--secondary-color)' : 
                                  type === 'error' ? 'var(--danger-color)' : 
                                  type === 'info' ? 'var(--primary-color)' : 'var(--text-secondary)';
        }

        function updateTryItSections() {
            const sections = document.querySelectorAll('.try-it-section');
            sections.forEach(section => {
                if (isAuthenticated) {
                    section.classList.add('authenticated');
                    section.style.background = '#e8f5e8';
                    section.style.borderColor = 'var(--secondary-color)';
                } else {
                    section.classList.remove('authenticated');
                    section.style.background = '#f8f9fa';
                    section.style.borderColor = 'var(--border-color)';
                }
            });
        }

        function toggleEndpointForm(endpointName) {
            if (!isAuthenticated) {
                updateTokenStatus('Please set a JWT token first', 'error');
                return;
            }
            
            const form = document.getElementById(`form_${endpointName}`);
            if (form.classList.contains('active')) {
                form.classList.remove('active');
            } else {
                // Close all other forms
                document.querySelectorAll('.endpoint-form').forEach(f => f.classList.remove('active'));
                form.classList.add('active');
            }
        }

        async function testEndpoint(method, params) {
            if (!isAuthenticated) {
                showResponse('get_user_info', 'Please set a JWT token first', 'error');
                return;
            }
            
            const requestId = document.getElementById(`id_${method}`).value || 1;
            
            const requestBody = {
                jsonrpc: '2.0',
                method: method,
                params: params,
                id: parseInt(requestId)
            };
            
            showResponse(method, 'Sending request...', 'info');
            
            try {
                const response = await fetch('/api/rpc', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const responseData = await response.json();
                const formattedResponse = JSON.stringify(responseData, null, 2);
                
                if (response.ok && !responseData.error) {
                    showResponse(method, formattedResponse, 'success');
                } else {
                    showResponse(method, formattedResponse, 'error');
                }
            } catch (error) {
                showResponse(method, `Network error: ${error.message}`, 'error');
            }
        }

        function testListDocuments() {
            const limit = parseInt(document.getElementById('limit_list_documents').value) || 10;
            const offset = parseInt(document.getElementById('offset_list_documents').value) || 0;
            
            const params = { limit, offset };
            testEndpoint('list_documents', params);
        }

        function testCreateDocument() {
            const title = document.getElementById('title_create_document').value;
            const content = document.getElementById('content_create_document').value;
            const tagsStr = document.getElementById('tags_create_document').value;
            const tags = tagsStr.split(',').map(tag => tag.trim()).filter(tag => tag);
            
            if (!title || !content) {
                showResponse('create_document', 'Title and content are required', 'error');
                return;
            }
            
            const params = { title, content, tags };
            testEndpoint('create_document', params);
        }

        function showResponse(endpoint, content, type) {
            const responseEl = document.getElementById(`response_${endpoint}`);
            responseEl.innerHTML = `
                <h4>Response <span class="status-indicator ${type}">${type.toUpperCase()}</span></h4>
                <pre style="white-space: pre-wrap; word-wrap: break-word; background: #f8f9fa; padding: 16px; border-radius: var(--border-radius); border: 1px solid var(--border-color); font-size: 12px; max-height: 400px; overflow-y: auto;">${content}</pre>
            `;
            responseEl.classList.add('show');
        }

        function copyToClipboard(button) {
            const codeBlock = button.parentElement;
            const text = codeBlock.textContent.replace(/Copy\s*/, '').trim();
            
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.style.background = 'rgba(52, 168, 83, 0.2)';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = 'rgba(255, 255, 255, 0.1)';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                button.textContent = 'Failed';
                setTimeout(() => {
                    button.textContent = 'Copy';
                }, 2000);
            });
        }

        // Enhanced error handling
        window.addEventListener('error', function(e) {
            console.error('JavaScript error:', e.error);
            updateTokenStatus('An unexpected error occurred', 'error');
        });

        // Smooth scrolling for navigation links
        document.addEventListener('click', function(e) {
            if (e.target.matches('a[href^="#"]')) {
                e.preventDefault();
                const target = document.querySelector(e.target.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
        });
    </script>
</body>
</html>